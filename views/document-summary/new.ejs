<%- include('../base-pm', {
    title: 'New Document Summary',
    description: 'Summarize a document with AI'
}) %>

<%- include('../partials/pm-nav') %>

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="fas fa-compress-alt me-2"></i>New Document Summary</h2>
            <p class="text-muted mb-0">Generate AI-powered summary with key points</p>
        </div>
        <a href="/document-summary" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Back
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Document Input</h5>
                </div>
                <div class="card-body">
                    <form id="summaryForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Document Name</label>
                                <input type="text" class="form-control" name="source_name" placeholder="e.g., Motion to Dismiss" value="<%= prefill.source_name %>">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Document Type</label>
                                <select class="form-select" name="source_type">
                                    <option value="general" <%= prefill.source_type === 'general' ? 'selected' : '' %>>General Document</option>
                                    <option value="contract" <%= prefill.source_type === 'contract' ? 'selected' : '' %>>Contract</option>
                                    <option value="pleading" <%= prefill.source_type === 'pleading' ? 'selected' : '' %>>Pleading</option>
                                    <option value="correspondence" <%= prefill.source_type === 'correspondence' ? 'selected' : '' %>>Correspondence</option>
                                    <option value="deposition" <%= prefill.source_type === 'deposition' ? 'selected' : '' %>>Deposition</option>
                                    <option value="evidence" <%= prefill.source_type === 'evidence' ? 'selected' : '' %>>Evidence</option>
                                    <option value="legal_brief" <%= prefill.source_type === 'legal_brief' ? 'selected' : '' %>>Legal Brief</option>
                                    <option value="court_order" <%= prefill.source_type === 'court_order' ? 'selected' : '' %>>Court Order</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Client (Optional)</label>
                                <select class="form-select" name="client_id">
                                    <option value="">-- Select Client --</option>
                                    <% clients.forEach(c => { %>
                                    <option value="<%= c.id %>" <%= prefill.client_id === c.id ? 'selected' : '' %>>
                                        <%= c.first_name %> <%= c.last_name %>
                                        <% if (c.company_name) { %> (<%= c.company_name %>)<% } %>
                                    </option>
                                    <% }) %>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Case (Optional - Required for Case Notes)</label>
                                <select class="form-select" name="case_id">
                                    <option value="">-- Select Case --</option>
                                    <% cases.forEach(c => { %>
                                    <option value="<%= c.id %>" <%= prefill.case_id === c.id ? 'selected' : '' %>><%= c.case_number %> - <%= c.title %></option>
                                    <% }) %>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Summary Length</label>
                                <select class="form-select" name="summary_length">
                                    <option value="brief">Brief (2-3 sentences)</option>
                                    <option value="medium" selected>Medium (1-2 paragraphs)</option>
                                    <option value="detailed">Detailed (3-4 paragraphs)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Target Audience</label>
                                <select class="form-select" name="target_audience">
                                    <option value="attorney" selected>Attorney</option>
                                    <option value="client">Client (Plain Language)</option>
                                    <option value="court">Court Filing</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Document Text <span class="text-danger">*</span></label>
                            <textarea class="form-control" name="original_text" rows="12"
                                placeholder="Paste the document text here..."><%= prefill.original_text %></textarea>
                            <div class="form-text">Minimum 50 characters required.</div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <div>
                                <button type="button" class="btn btn-outline-info me-2" id="loadExampleBtn">
                                    <i class="fas fa-flask me-1"></i>Load Example
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="document.querySelector('[name=original_text]').value = ''">
                                    <i class="fas fa-eraser me-1"></i>Clear
                                </button>
                            </div>
                            <button type="submit" class="btn btn-primary" id="summarizeBtn">
                                <i class="fas fa-robot me-1"></i>Generate Summary
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Summary Options</h5>
                </div>
                <div class="card-body">
                    <h6>Audience Styles:</h6>
                    <ul class="small">
                        <li><strong>Attorney:</strong> Legal terminology, precise, includes citations</li>
                        <li><strong>Client:</strong> Plain language, no jargon, easy to understand</li>
                        <li><strong>Court:</strong> Formal language, objective, factual</li>
                    </ul>

                    <hr>

                    <h6>Key Points Extracted:</h6>
                    <ul class="small">
                        <li>Critical facts</li>
                        <li>Legal issues</li>
                        <li>Important dates</li>
                        <li>Party obligations</li>
                        <li>Holdings and rulings</li>
                    </ul>
                </div>
            </div>

            <div class="card mt-3" id="progressCard" style="display: none;">
                <div class="card-body text-center">
                    <div class="spinner-border text-primary mb-3" role="status"></div>
                    <h5>Generating Summary</h5>
                    <p class="text-muted">Analyzing document...</p>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Load Example Data
document.getElementById('loadExampleBtn').addEventListener('click', function() {
    document.querySelector('[name=source_name]').value = 'Motion to Dismiss - Smith v. ABC Corporation';
    document.querySelector('[name=source_type]').value = 'pleading';
    document.querySelector('[name=original_text]').value = `UNITED STATES DISTRICT COURT
NORTHERN DISTRICT OF CALIFORNIA

JOHN SMITH,
    Plaintiff,
v.                                          Case No. 3:24-cv-01234
ABC CORPORATION,
    Defendant.

DEFENDANT'S MOTION TO DISMISS

Defendant ABC Corporation, by and through its attorneys, hereby moves this Court pursuant to Federal Rule of Civil Procedure 12(b)(6) to dismiss Plaintiff's Complaint for failure to state a claim upon which relief can be granted.

I. INTRODUCTION

Plaintiff John Smith filed this action on January 15, 2024, alleging breach of contract and negligent misrepresentation arising from a commercial lease agreement. However, Plaintiff's Complaint fails to allege sufficient facts to support either claim.

II. FACTUAL BACKGROUND

On March 1, 2023, Plaintiff entered into a commercial lease agreement with Defendant for office space located at 123 Main Street, San Francisco, California. The lease term was for three years with monthly rent of $5,000. Plaintiff alleges that Defendant failed to maintain the HVAC system, resulting in business losses.

III. LEGAL STANDARD

To survive a motion to dismiss under Rule 12(b)(6), a complaint must contain sufficient factual matter to state a claim for relief that is plausible on its face. Ashcroft v. Iqbal, 556 U.S. 662, 678 (2009).

IV. ARGUMENT

A. Plaintiff's Breach of Contract Claim Fails

Plaintiff has failed to identify any specific provision of the lease agreement that was breached. The lease clearly states that Defendant's maintenance obligations are limited to structural repairs, not HVAC maintenance.

B. Plaintiff's Negligent Misrepresentation Claim Fails

Plaintiff cannot establish the elements of negligent misrepresentation because: (1) no false statement was made; (2) Plaintiff conducted his own inspection before signing the lease; and (3) any reliance was unreasonable.

V. CONCLUSION

For the foregoing reasons, Defendant respectfully requests that this Court grant its Motion to Dismiss with prejudice.

Dated: February 28, 2024

Respectfully submitted,
JOHNSON & ASSOCIATES LLP

By: _______________________
    Sarah Johnson, Esq.
    Attorney for Defendant`;
});

document.getElementById('summaryForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());

    if (!data.original_text || data.original_text.length < 50) {
        alert('Please enter at least 50 characters of text');
        return;
    }

    const btn = document.getElementById('summarizeBtn');
    const progress = document.getElementById('progressCard');

    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Summarizing...';
    progress.style.display = 'block';

    try {
        const response = await fetch('/api/document-summary/summarize', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
            window.location.href = '/document-summary/' + result.summaryId;
        } else {
            alert('Error: ' + (result.error || 'Summarization failed'));
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-robot me-1"></i>Generate Summary';
            progress.style.display = 'none';
        }
    } catch (error) {
        alert('Error: ' + error.message);
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-robot me-1"></i>Generate Summary';
        progress.style.display = 'none';
    }
});
</script>
</body>
</html>
