<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title : 'Legal Forms Generator' %></title>
    <meta name="description" content="Generate professional legal documents quickly and accurately using AI-powered templates.">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/css/custom.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <div class="brand-icon me-2">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <span class="brand-text">LegalForms<span class="text-primary">AI</span></span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/#form-types">Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#features">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container my-4">
        <div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item active"><%= formConfig.name %></li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <h1><%= formConfig.name %></h1>
        <p class="lead"><%= formConfig.description %></p>
        <hr>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Document Information</h5>
            </div>
            <div class="card-body">
                <form id="documentForm">
                    <!-- Form Type Selection -->
                    <div class="mb-4">
                        <label for="specificFormType" class="form-label">Select Specific Document Type *</label>
                        <select class="form-select" id="specificFormType" name="specificFormType" required>
                            <option value="">Choose a specific document type...</option>
                        </select>
                        <small class="form-text text-muted">Select the exact type of document you need to generate.</small>
                    </div>
                    
                    <div id="formFields">
                        <!-- Dynamic form fields will be loaded here -->
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-file-alt me-2"></i>
                                Generate Document
                            </button>
                            <button type="button" class="btn btn-secondary btn-lg ms-2" onclick="resetForm()">
                                <i class="fas fa-undo me-2"></i>
                                Reset Form
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Form Instructions</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li><i class="fas fa-check text-success me-2"></i>Fill out all required fields</li>
                    <li><i class="fas fa-check text-success me-2"></i>Provide accurate information</li>
                    <li><i class="fas fa-check text-success me-2"></i>Review generated document</li>
                    <li><i class="fas fa-check text-success me-2"></i>Consult with attorney if needed</li>
                </ul>
                
                <div class="alert alert-warning mt-3">
                    <small>
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        Always have legal documents reviewed by a qualified attorney before use.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-4">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5>Generating Document...</h5>
                <p class="text-muted">Please wait while we create your legal document.</p>
            </div>
        </div>
    </div>
</div>

<!-- Results Modal -->
<div class="modal fade" id="resultsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generated Document</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="documentContent" class="generated-document"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="downloadBtn">
                    <i class="fas fa-download me-2"></i>Download Document
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let currentFilename = null;

// Load form types when page loads
$(document).ready(function() {
    console.log('Page loaded, loading form types...');
    loadSpecificFormTypes();
});

function loadSpecificFormTypes() {
    const formType = '<%= formType %>';
    console.log('Loading form types for:', formType);
    
    // Add error handling and timeout
    $.ajax({
        url: `/api/form-types/${formType}`,
        method: 'GET',
        timeout: 10000,
        success: function(types) {
            console.log('Received form types:', types);
            renderSpecificFormTypes(types);
        },
        error: function(xhr, status, error) {
            console.error('Error loading form types:', error, xhr.responseText);
            $('#specificFormType').html('<option value="">Error loading form types</option>');
        }
    });
}

function renderSpecificFormTypes(types) {
    console.log('Rendering types:', types);
    let html = '<option value="">Choose a specific document type...</option>';
    
    if (types && Array.isArray(types) && types.length > 0) {
        types.forEach(function(type) {
            console.log('Adding type:', type);
            html += `<option value="${type.value}">${type.label}</option>`;
        });
    } else {
        console.log('No types available or invalid data:', types);
        html += '<option value="">No document types available</option>';
    }
    
    console.log('Setting dropdown HTML:', html);
    $('#specificFormType').html(html);
}

// Handle specific form type selection
$('#specificFormType').on('change', function() {
    const specificType = $(this).val();
    if (specificType) {
        loadFormFields(specificType);
    } else {
        $('#formFields').html('');
    }
});

function loadFormFields(specificType) {
    const formType = '<%= formType %>';
    
    $.get(`/api/form-fields/${formType}/${specificType}`)
        .done(function(fields) {
            renderFormFields(fields);
        })
        .fail(function() {
            $('#formFields').html('<div class="alert alert-danger">Error loading form fields</div>');
        });
}

function renderFormFields(fields) {
    let html = '';
    
    fields.forEach(function(field) {
        html += '<div class="mb-3">';
        html += `<label for="${field.name}" class="form-label">`;
        html += field.label;
        if (field.required) {
            html += ' <span class="text-danger">*</span>';
        }
        html += '</label>';
        
        if (field.type === 'select') {
            html += `<select class="form-select" id="${field.name}" name="${field.name}"`;
            if (field.required) html += ' required';
            html += '>';
            html += '<option value="">Select an option</option>';
            field.options.forEach(function(option) {
                html += `<option value="${option}">${option}</option>`;
            });
            html += '</select>';
        } else if (field.type === 'textarea') {
            html += `<textarea class="form-control" id="${field.name}" name="${field.name}" rows="3"`;
            if (field.required) html += ' required';
            html += '></textarea>';
        } else {
            html += `<input type="${field.type}" class="form-control" id="${field.name}" name="${field.name}"`;
            if (field.required) html += ' required';
            html += '>';
        }
        
        html += '</div>';
    });
    
    $('#formFields').html(html);
}

function resetForm() {
    document.getElementById('documentForm').reset();
}

// Handle form submission
$('#documentForm').on('submit', function(e) {
    e.preventDefault();
    
    // Check if specific form type is selected
    const specificType = $('#specificFormType').val();
    if (!specificType) {
        alert('Please select a specific document type first.');
        return;
    }
    
    // Collect form data
    const formData = {};
    $(this).find('input, select, textarea').each(function() {
        if (this.name) {
            formData[this.name] = this.value;
        }
    });
    
    // Add specific form type to form data
    formData.specific_form_type = specificType;
    
    // Show loading modal
    $('#loadingModal').modal('show');
    
    // Submit to backend
    $.ajax({
        url: '/generate',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            form_type: '<%= formType %>',
            specific_type: specificType,
            form_data: formData
        }),
        success: function(response) {
            $('#loadingModal').modal('hide');
            
            if (response.success) {
                $('#documentContent').text(response.document);
                currentFilename = response.filename;
                $('#resultsModal').modal('show');
            } else {
                alert('Error generating document: ' + response.error);
            }
        },
        error: function(xhr) {
            $('#loadingModal').modal('hide');
            alert('Error generating document. Please try again.');
        }
    });
});

// Handle download
$('#downloadBtn').on('click', function() {
    if (currentFilename) {
        window.location.href = `/download/${currentFilename}`;
    }
});
</script>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="brand-icon me-2 text-white">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <span class="brand-text text-white">LegalForms<span class="text-primary">AI</span></span>
                    </div>
                    <p class="text-muted">Professional legal document generation powered by advanced AI technology.</p>
                </div>
                <div class="col-lg-8 mb-4">
                    <h6 class="text-white mb-3">Important Legal Disclaimer</h6>
                    <p class="text-muted small">
                        This tool generates legal document templates for informational purposes only. 
                        All generated documents should be reviewed by a qualified attorney before use. 
                        Laws vary by jurisdiction, and professional legal advice is recommended for all legal matters.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
</html>
